<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê≤ SƒÉn R·ªìng - C·∫•u h√¨nh Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        .rules-section {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .rules-list {
            list-style: none;
            padding: 0;
        }

        .rules-list li {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .betting-rules {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        .rule-item {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .rule-header h3 {
            color: #17a2b8;
            margin: 0;
        }

        .priority-badge {
            background: #17a2b8;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .pattern-display {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .pattern-item {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .bet-amounts {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .bet-amount {
            background: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Hide file input for loading config */
        .file-input {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 20px;
            }

            .section {
                padding: 20px;
            }

            .buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üê≤ SƒÉn R·ªìng</h1>
            <p>C·∫•u h√¨nh Game v√† Chi·∫øn thu·∫≠t C∆∞·ª£c</p>
        </div>

        <div class="content">
            Game Settings Section
            <div class="section">
                <h2>‚öôÔ∏è C√†i ƒë·∫∑t Game</h2>
                <div class="form-group">
                    <label>üí∞ S·ªë ti·ªÅn c∆∞·ª£c m·ªói l·∫ßn:</label>
                    <input type="number" id="betAmount" value="1000" min="100" step="100">
                </div>
                <div class="form-group">
                    <label>üé∞ Ng∆∞·ª°ng Jackpot:</label>
                    <input type="number" id="jackpotThreshold" value="500000" min="10000" step="10000">
                </div>
                <div class="form-group">
                    <label>üõë D·ª´ng c∆∞·ª£c khi thua:</label>
                    <input type="number" id="betStop" value="10000" min="1000" step="1000">
                </div>
                <div class="form-group">
                    <label>‚è±Ô∏è Th·ªùi gian g·ª≠i tin nh·∫Øn (gi√¢y):</label>
                    <input type="number" id="timeSendMess" value="1" min="1" max="10">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="isMartingale">
                        <label for="isMartingale">üìà S·ª≠ d·ª•ng chi·∫øn thu·∫≠t Martingale</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>üìä T·ª∑ l·ªá Martingale:</label>
                    <input type="number" id="rateMartingale" value="2" min="1.5" max="5" step="0.1">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="zombie" checked>
                        <label for="zombie">üßü Ch·∫ø ƒë·ªô Zombie (t·ª± ƒë·ªông)</label>
                    </div>
                </div>
            </div>

            Game Rules Section
            <div class="section rules-section">
                <h2>üìã Lu·∫≠t ch∆°i</h2>
                <ul class="rules-list">
                    <li>üé≤ N·∫øu 3 vi√™n x√∫c x·∫Øc ra c√πng m·ªôt s·ªë (b·ªô ba ƒë·ªìng nh·∫•t), k·∫øt qu·∫£ l√† B√ÉO v√† nh√† c√°i th·∫Øng</li>
                    <li>‚¨ÜÔ∏è T·ªïng ƒëi·ªÉm t·ª´ 11 ƒë·∫øn 17 l√† T√ÄI</li>
                    <li>‚¨áÔ∏è T·ªïng ƒëi·ªÉm t·ª´ 4 ƒë·∫øn 10 l√† X·ªàU</li>
                    <li>üéØ Tr√≤ ch∆°i d·ª±a tr√™n k·∫øt qu·∫£ c·ªßa 3 vi√™n x√∫c x·∫Øc</li>
                </ul>
            </div>

            Betting Rules Section
            <div class="section betting-rules">
                <h2>üéØ Quy t·∫Øc c∆∞·ª£c</h2>
            </div>

            Action Buttons
            <div class="buttons">
                <button class="btn btn-success" onclick="saveConfig()">
                    üíæ L∆∞u c·∫•u h√¨nh
                </button>
                <button class="btn btn-danger" onclick="resetConfig()">
                    üîÑ Reset v·ªÅ m·∫∑c ƒë·ªãnh
                </button>
            </div>

            Hidden file input for loading config from src
            <input type="file" id="configFileInput" class="file-input" accept=".json"
                onchange="loadConfigFromFile(event)">

            <div id="status" class="status"></div>
        </div>
    </div>

    <script>
        const CONFIG_FILE_PATH = '../../config/dragon-hunt.json';
        console.log('Loading config from:', CONFIG_FILE_PATH);

        let currentConfig = {};

        document.addEventListener('DOMContentLoaded', function () {
            loadConfigFromSrc();
            setupFormSync();
        });

        async function loadConfigFromSrc() {
            try {
                const response = await fetch(CONFIG_FILE_PATH);
                if (response.ok) {
                    const config = await response.json();
                    currentConfig = config;
                    updateFormFromConfig(config);
                    updateBettingRulesDisplay(config.bettingRules);
                    showStatus('‚úÖ ƒê√£ t·∫£i c·∫•u h√¨nh t·ª´ ../../config/dragon-hunt.json!', 'success');
                } else {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i file config');
                }
            } catch (error) {
                showStatus('‚ùå Kh√¥ng t√¨m th·∫•y file config t·∫°i ../../config/dragon-hunt.json', 'error');
            }
        }

        function updateFormFromConfig(config) {
            const settings = config.gameSettings;

            document.getElementById('betAmount').value = settings.BET_AMOUNT;
            document.getElementById('jackpotThreshold').value = settings.JACKPOT_THRESHOLD;
            document.getElementById('betStop').value = settings.BET_STOP;
            document.getElementById('timeSendMess').value = settings.TIME_SEND_MESS;
            document.getElementById('isMartingale').checked = settings.IS_MARTINGALE;
            document.getElementById('rateMartingale').value = settings.RATE_MARTINGALE;
            document.getElementById('zombie').checked = settings.ZOMBIE;
        }

        function updateBettingRulesDisplay(bettingRules) {
            const bettingSection = document.querySelector('.betting-rules');
            const existingRules = bettingSection.querySelectorAll('.rule-item');
            existingRules.forEach(rule => rule.remove());

            bettingRules.forEach((rule, index) => {
                const ruleDiv = document.createElement('div');
                ruleDiv.className = 'rule-item';
                ruleDiv.innerHTML = `
                    <div class="rule-header">
                        <h3>Quy t·∫Øc ${index + 1}</h3>
                        <span class="priority-badge">∆Øu ti√™n: ${rule.priority}</span>
                        <button class="btn btn-danger" onclick="deleteRule(${index})" style="padding: 5px 10px; font-size: 12px;">üóëÔ∏è X√≥a</button>
                    </div>
                    <p><strong>M√¥ t·∫£:</strong> ${rule.description}</p>
                    ${rule.pattern && rule.pattern.length > 0 ? `
                        <p><strong>Pattern:</strong></p>
                        <div class="pattern-display">
                            ${rule.pattern.map(p => `<span class="pattern-item">${p}</span>`).join('')}
                        </div>
                    ` : ''}
                    <p><strong>C∆∞·ª£c:</strong> ${Array.isArray(rule.betOn) ? rule.betOn.join(', ') : rule.betOn}</p>
                    <div class="bet-amounts">
                        ${Array.isArray(rule.betAmount) ?
                        rule.betAmount.map((amount, i) => `<span class="bet-amount">${Array.isArray(rule.betOn) ? rule.betOn[i] : 'C∆∞·ª£c'}: ${amount.toLocaleString()} VNƒê</span>`).join('') :
                        `<span class="bet-amount">${rule.betAmount.toLocaleString()} VNƒê</span>`
                    }
                    </div>
                `;
                bettingSection.appendChild(ruleDiv);
            });

            const addRuleBtn = document.createElement('button');
            addRuleBtn.className = 'btn btn-primary';
            addRuleBtn.innerHTML = '‚ûï Th√™m quy t·∫Øc c∆∞·ª£c m·ªõi';
            addRuleBtn.onclick = showAddRuleForm;
            bettingSection.appendChild(addRuleBtn);
        }

        function showAddRuleForm() {
            const formHtml = `
                <div id="addRuleModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                        <h3>‚ûï Th√™m quy t·∫Øc c∆∞·ª£c m·ªõi</h3>
                        <div class="form-group">
                            <label>M√¥ t·∫£:</label>
                            <input type="text" id="newRuleDescription" placeholder="V√≠ d·ª•: RED ‚Üí BLUE ‚Üí WHITE c∆∞·ª£c PURPLE">
                        </div>
                        <div class="form-group">
                            <label>∆Øu ti√™n (0-10):</label>
                            <input type="number" id="newRulePriority" value="5" min="0" max="10">
                        </div>
                        <div class="form-group">
                            <label>Pattern (c√°ch nhau b·ªüi d·∫•u ph·∫©y):</label>
                            <input type="text" id="newRulePattern" placeholder="RED,BLUE,WHITE">
                        </div>
                        <div class="form-group">
                            <label>C∆∞·ª£c v√†o:</label>
                            <input type="text" id="newRuleBetOn" placeholder="PURPLE ho·∫∑c RED,BLUE,PINK">
                        </div>
                        <div class="form-group">
                            <label>S·ªë ti·ªÅn c∆∞·ª£c:</label>
                            <input type="text" id="newRuleBetAmount" placeholder="5000 ho·∫∑c 1000,2000,500">
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                            <button class="btn btn-danger" onclick="closeAddRuleForm()">‚ùå H·ªßy</button>
                            <button class="btn btn-success" onclick="addNewRule()">‚úÖ Th√™m</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', formHtml);
        }

        function closeAddRuleForm() {
            const modal = document.getElementById('addRuleModal');
            if (modal) modal.remove();
        }

        function addNewRule() {
            const description = document.getElementById('newRuleDescription').value;
            const priority = parseInt(document.getElementById('newRulePriority').value);
            const pattern = document.getElementById('newRulePattern').value.split(',').map(s => s.trim()).filter(s => s);
            const betOnStr = document.getElementById('newRuleBetOn').value;
            const betAmountStr = document.getElementById('newRuleBetAmount').value;

            if (!description || !betOnStr || !betAmountStr) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }

            const betOn = betOnStr.includes(',') ? betOnStr.split(',').map(s => s.trim()) : betOnStr.trim();
            const betAmount = betAmountStr.includes(',') ?
                betAmountStr.split(',').map(s => parseInt(s.trim())) :
                parseInt(betAmountStr.trim());

            const newRule = {
                betOn,
                priority,
                active: true,
                description,
                betAmount,
                pattern
            };

            currentConfig.bettingRules.push(newRule);
            updateBettingRulesDisplay(currentConfig.bettingRules);
            closeAddRuleForm();
            showStatus('‚úÖ ƒê√£ th√™m quy t·∫Øc c∆∞·ª£c m·ªõi!', 'success');
        }

        function deleteRule(index) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a quy t·∫Øc n√†y?')) {
                currentConfig.bettingRules.splice(index, 1);
                updateBettingRulesDisplay(currentConfig.bettingRules);
                showStatus('‚úÖ ƒê√£ x√≥a quy t·∫Øc c∆∞·ª£c!', 'success');
            }
        }

        function updateConfigFromForm() {
            currentConfig.gameSettings = {
                "BET_AMOUNT": parseInt(document.getElementById('betAmount').value),
                "JACKPOT_THRESHOLD": parseInt(document.getElementById('jackpotThreshold').value),
                "BET_STOP": parseInt(document.getElementById('betStop').value),
                "TIME_SEND_MESS": parseInt(document.getElementById('timeSendMess').value),
                "IS_MARTINGALE": document.getElementById('isMartingale').checked,
                "RATE_MARTINGALE": parseFloat(document.getElementById('rateMartingale').value),
                "ZOMBIE": document.getElementById('zombie').checked
            };
        }

        async function saveConfig() {
            try {
                updateConfigFromForm();

                if (!currentConfig.gameSettings || !currentConfig.gameRules || !currentConfig.bettingRules) {
                    throw new Error('C·∫•u tr√∫c config kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng');
                }

                const jsonContent = JSON.stringify(currentConfig, null, 4);
                const blob = new Blob([jsonContent], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'dragon-hunt.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showStatus('‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh th√†nh c√¥ng! File ƒë√£ ƒë∆∞·ª£c t·∫£i v·ªÅ ƒë·ªÉ thay th·∫ø trong ../../config/', 'success');
            } catch (error) {
                showStatus('‚ùå L·ªói khi l∆∞u: ' + error.message, 'error');
            }
        }

        async function resetConfig() {
            if (confirm('üîÑ B·∫°n c√≥ ch·∫Øc mu·ªën reset v·ªÅ c·∫•u h√¨nh m·∫∑c ƒë·ªãnh?')) {
                try {
                    const response = await fetch('../../config/dragon-hunt-default.json');
                    if (response.ok) {
                        const defaultConfig = await response.json();
                        currentConfig = { ...defaultConfig };
                        updateFormFromConfig(defaultConfig);
                        updateBettingRulesDisplay(defaultConfig.bettingRules);
                        showStatus('üîÑ ƒê√£ reset v·ªÅ c·∫•u h√¨nh m·∫∑c ƒë·ªãnh t·ª´ file!', 'success');
                    } else {
                        throw new Error('Kh√¥ng t√¨m th·∫•y file c·∫•u h√¨nh m·∫∑c ƒë·ªãnh');
                    }
                } catch (error) {
                    showStatus('‚ùå Kh√¥ng th·ªÉ t·∫£i c·∫•u h√¨nh m·∫∑c ƒë·ªãnh: ' + error.message, 'error');
                }
            }
        }

        function setupFormSync() {
            const formInputs = [
                'betAmount', 'jackpotThreshold', 'betStop', 'timeSendMess',
                'isMartingale', 'rateMartingale', 'zombie'
            ];

            formInputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                if (element) {
                    element.addEventListener('input', function () {
                        clearTimeout(window.formSyncTimeout);
                        window.formSyncTimeout = setTimeout(() => {
                            updateConfigFromForm();
                        }, 500);
                    });
                }
            });
        }

        function loadConfigFromFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const config = JSON.parse(e.target.result);
                        currentConfig = config;
                        updateFormFromConfig(config);
                        updateBettingRulesDisplay(config.bettingRules);
                        showStatus('‚úÖ ƒê√£ t·∫£i c·∫•u h√¨nh t·ª´ file!', 'success');
                    } catch (error) {
                        showStatus('‚ùå File JSON kh√¥ng h·ª£p l·ªá: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>

</html>